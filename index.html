<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«è¶¨å‹¢å„€è¡¨æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .controls { margin-bottom: 20px; text-align: center; }
        select { padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ddd; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border-left: 5px solid #007bff; }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 14px; color: #666; }
        .stat-card p { margin: 0; font-size: 24px; font-weight: bold; color: #333; }
        canvas { max-width: 100%; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ‹ï¸ å¥èº«è¶¨å‹¢åœ–</h1>
    
    <div class="controls">
        <label for="exerciseSelect">é¸æ“‡å‹•ä½œï¼š</label>
        <select id="exerciseSelect" onchange="updateDashboard()">
            </select>
    </div>

    <div class="stats-grid">
        <div class="stat-card" style="border-color: #28a745;">
            <h3>PR (æœ€é«˜è¨“ç·´é‡)</h3>
            <p id="prValue">-</p>
        </div>
        <div class="stat-card" style="border-color: #17a2b8;">
            <h3>æœ€è¿‘ä¸€æ¬¡è¨“ç·´é‡</h3>
            <p id="latestVolume">-</p>
        </div>
        <div class="stat-card" style="border-color: #ffc107;">
            <h3>æœ€è¿‘è¨“ç·´æ—¥æœŸ</h3>
            <p id="latestDate">-</p>
        </div>
        <div class="stat-card" style="border-color: #dc3545;">
            <h3>ç¸½è¨“ç·´æ¬¡æ•¸</h3>
            <p id="totalSessions">-</p>
        </div>
    </div>

    <canvas id="trendChart"></canvas>
</div>

<script>
    // 1. åŸå§‹æ•¸æ“š (ä¾†è‡ª Google Sheets çš„ Log)
    const rawData = [
        {date: '2025-10-09', action: 'é…’æ¯è¹²', volume: 360},
        {date: '2025-10-09', action: 'RDL', volume: 200},
        {date: '2025-10-16', action: 'é›ªæ©‡è¡Œèµ°', volume: 32}, // ç¯„ä¾‹ï¼šå·²ç°¡åŒ–å¤šçµ„æ•¸æ“šç‚ºå–®ç­†ï¼Œæˆ–éœ€èšåˆ
        {date: '2025-10-16', action: 'é…’æ¯è¹²', volume: 160},
        {date: '2025-10-16', action: 'ç®±ä¸Šé…’æ¯è¹²', volume: 240},
        {date: '2025-10-16', action: 'æ§“éˆ´æ·±è¹²', volume: 150},
        {date: '2025-11-06', action: 'æ§“éˆ´ DRL', volume: 685}, // èšåˆç•¶æ—¥ç¸½é‡
        {date: '2025-11-06', action: 'æ§“éˆ´è‚©æ¨', volume: 290},
        {date: '2025-11-14', action: 'æ§“éˆ´ DRL', volume: 570},
        {date: '2025-11-14', action: 'é…’æ¯è¹²', volume: 675},
        {date: '2025-11-14', action: 'æ§“éˆ´è‚©æ¨', volume: 200},
        {date: '2025-11-20', action: 'å½ˆåŠ›ç¹©å¼•é«”å‘ä¸Š', volume: 2400},
        {date: '2025-11-20', action: 'ä¿¯è‡¥æ§“éˆ´åˆ’èˆ¹', volume: 700},
        {date: '2025-11-20', action: 'æ§“éˆ´æ·±è¹²', volume: 425},
        {date: '2025-11-27', action: 'å½ˆåŠ›ç¹©å¼•é«”å‘ä¸Š', volume: 1200},
        {date: '2025-12-18', action: 'é…’æ¯è¹²', volume: 336},
        {date: '2025-12-18', action: 'ç®±ä¸Šè¹²', volume: 224},
        {date: '2025-12-18', action: 'è‚©æ¨', volume: 444.5},
        {date: '2025-12-18', action: 'å…­è§’æ§“', volume: 562.5}
    ];

    // 2. å‹•ä½œæ¸…å–® (ä¾†è‡ª Google Sheets çš„ Lists)
    const actionList = [
        "é…’æ¯è¹²", "RDL", "é›ªæ©‡è¡Œèµ°", "ç®±ä¸Šé…’æ¯è¹²", "æ§“éˆ´æ·±è¹²", 
        "æ§“éˆ´ DRL", "æ§“éˆ´è‚©æ¨", "å½ˆåŠ›ç¹©å¼•é«”å‘ä¸Š", "ä¿¯è‡¥æ§“éˆ´åˆ’èˆ¹", 
        "ç®±ä¸Šè¹²", "è‚©æ¨", "å…­è§’æ§“"
    ];

    let chartInstance = null;

    // åˆå§‹åŒ–é é¢
    function init() {
        const select = document.getElementById('exerciseSelect');
        actionList.forEach(action => {
            const option = document.createElement('option');
            option.value = action;
            option.text = action;
            select.appendChild(option);
        });
        
        // é è¨­é¸æ“‡ç¬¬ä¸€å€‹
        select.value = "é…’æ¯è¹²";
        updateDashboard();
    }

    // æ›´æ–°å„€è¡¨æ¿æ•¸æ“š
    function updateDashboard() {
        const selectedAction = document.getElementById('exerciseSelect').value;
        
        // éæ¿¾å‡ºè©²å‹•ä½œçš„æ•¸æ“šï¼Œä¸¦æŒ‰æ—¥æœŸæ’åº
        const filteredData = rawData
            .filter(d => d.action === selectedAction)
            .sort((a, b) => new Date(a.date) - new Date(b.date));

        // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
        if (filteredData.length === 0) {
            document.getElementById('prValue').innerText = "ç„¡æ•¸æ“š";
            document.getElementById('latestVolume').innerText = "-";
            document.getElementById('latestDate').innerText = "-";
            document.getElementById('totalSessions').innerText = "0";
            renderChart([], []);
            return;
        }

        const volumes = filteredData.map(d => d.volume);
        const dates = filteredData.map(d => d.date);
        
        const pr = Math.max(...volumes);
        const latestVol = volumes[volumes.length - 1];
        const latestDt = dates[dates.length - 1];
        const count = volumes.length;

        document.getElementById('prValue').innerText = pr.toLocaleString();
        document.getElementById('latestVolume').innerText = latestVol.toLocaleString();
        document.getElementById('latestDate').innerText = latestDt;
        document.getElementById('totalSessions').innerText = count;

        renderChart(dates, volumes);
    }

    // ç¹ªè£½åœ–è¡¨
    function renderChart(labels, data) {
        const ctx = document.getElementById('trendChart').getContext('2d');
        
        if (chartInstance) {
            chartInstance.destroy();
        }

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'è¨“ç·´é‡ (Volume)',
                    data: data,
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'è¨“ç·´é‡è¶¨å‹¢' }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Volume (kg * reps * sets)' } },
                    x: { title: { display: true, text: 'æ—¥æœŸ' } }
                }
            }
        });
    }

    // å•Ÿå‹•
    init();
</script>

</body>
</html>
